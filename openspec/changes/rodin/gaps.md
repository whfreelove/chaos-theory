# Rodin Gaps Analysis

### GAP-38: Validator output format unspecified — RESOLVED
- **Category**: missing
- **Severity**: high
- **Resolution**: Structured markdown format like critic: `### VERDICT: PASS` or `### VERDICT: FAIL`, `**Reason**: <explanation>`. Easy for orchestrating agent to parse.

### GAP-30: Design line 69 contradicts hook behavior — RESOLVED
- **Category**: contradiction
- **Severity**: high
- **Resolution**: Fix design.md line 69 to match code. Hook BLOCKS when no gate.yml exists. Assessment is required once plugin is installed (not opt-in per-session).

### GAP-14: Artifact path inconsistency — RESOLVED
- **Category**: contradiction
- **Severity**: high
- **Resolution**: Updated proposal to specify subdirectory path. Updated design hook logic to use explicit `$RODIN_DIR` and derive paths from session name. Authoritative path is `~/.claude/plans/rodin-plan-gate/<session>.*`

### GAP-15: No API to query permission_mode — RESOLVED
- **Category**: missing
- **Severity**: high
- **Resolution**: Hooks receive `permission_mode` directly in JSON input. PostToolUse hook checks `permission_mode == "plan"` and only runs in plan mode. No workaround needed—Claude Code provides this data.

### GAP-19: Fresh agent context transfer unaddressed — RESOLVED (reframed)
- **Category**: unclear
- **Severity**: high
- **Resolution**: Reframed proposal's "why" entirely. The value is adversarial validation forcing honest gap articulation—not cross-session handoff. Removed "fresh agent" framing from proposal and design.

### GAP-21: Missing plan-assessment skill spec — RESOLVED
- **Category**: missing
- **Severity**: high
- **Resolution**: The existing spec already covers both skill and hook requirements (lines 1-82 for skill, 84-101 for hook). Updated proposal to list single combined capability `plan-exit-gate` that includes both skill and hook.

### GAP-13: Hash bypass enables gaming — RESOLVED
- **Category**: risk
- **Severity**: high
- **Resolution**: PreToolUse hook implements "stale = block" policy. Hash mismatch blocks exit with "Re-run /rodin:plan-gate" message. Agent cannot game by making trivial edits—any edit invalidates verdict and requires re-assessment.

### GAP-3: Leakage detection too aggressive — RESOLVED
- **Category**: risk
- **Severity**: high
- **Resolution**: Keyword threshold approach: only flag if 3+ distinct gap-like phrases appear. Single phrases pass through (minor slips acceptable, major ones caught by critic). Overzealous matching risk accepted as trade-off—cheap to implement, easy to rip out if it doesn't work in MVP.

### GAP-5: Plan file discovery undefined — RESOLVED
- **Category**: missing
- **Severity**: high
- **Resolution**: PostToolUse hook on Write|Edit creates slug→session_id mapping file (`<slug>.session` contains session_id). Skill reads mapping to find session_id. ExitPlanMode hook receives session_id directly in input. No "most recently modified" heuristic needed—deterministic mapping via hooks.

### GAP-31: UUID source undefined — RESOLVED
- **Category**: missing
- **Severity**: medium
- **Resolution**: Use `session_id` consistently throughout design. Remove UUID terminology. session_id comes from Claude Code's hook input (not generated by plugin).

### GAP-32: Critic output format unspecified — RESOLVED
- **Category**: missing
- **Severity**: medium
- **Resolution**: Critic returns structured markdown: `### FINDING-N: <title>`, `**Severity**: high|medium|low`, `**Description**: ...`. Easy for validator LLM to parse.

### GAP-33: Plan file path detection mechanism incomplete — RESOLVED
- **Category**: unclear
- **Severity**: medium
- **Resolution**: Skill prompt instructs agent to extract plan file path from system message (LLM extraction). Claude Code includes plan file path in system context when in plan mode. GAP-28 already acknowledges this platform dependency.

### GAP-36: Race condition between PostToolUse and skill — RESOLVED (acknowledged)
- **Category**: risk
- **Severity**: medium
- **Resolution**: Edge case that shouldn't occur if agent follows flow correctly—nothing else should be happening during validation. Skill atomically writes verdict after subagent chain completes. Agent shouldn't edit files mid-assessment.

### GAP-39: No handling for critic finding zero issues — RESOLVED
- **Category**: unclear
- **Severity**: medium
- **Resolution**: Critic prompt must explicitly declare "no gaps found" if none detected. Zero findings without explicit declaration fails. Validator checks for explicit "no issues" statement, not just empty findings list.

### GAP-40: Gaps merge conflict potential — RESOLVED (acknowledged)
- **Category**: risk
- **Severity**: medium
- **Resolution**: Edge case—shouldn't happen if agent follows flow. Leakage detector runs before agent edits gaps.md. Sequential execution assumed. No locking for MVP.

### GAP-41: Undefined behavior when gaps.md is deleted — RESOLVED
- **Category**: missing
- **Severity**: medium
- **Resolution**: Fail closed. If gate.yml has gaps_file but file is missing, hook blocks exit and requires re-assessment. Add check: if gaps_file populated but file missing, fail.

### GAP-42: Critic prompt content not specified — RESOLVED
- **Category**: missing
- **Severity**: medium
- **Resolution**: Document key prompt elements in design: (1) adversarial role, (2) focus on goals mismatches/blockers/assumptions/risks, (3) structured output format, (4) explicit "no issues" if none found. Full prompt deferred to implementation.

### GAP-43: Task tool model selection not configurable — RESOLVED
- **Category**: assumption
- **Severity**: medium
- **Resolution**: Verified. Task tool supports `model` parameter with values "sonnet", "opus", "haiku", "inherit". Design correctly specifies model per subagent.

### GAP-44: Empty plan scenario not handled — RESOLVED (acknowledged)
- **Category**: risk
- **Severity**: medium
- **Resolution**: Accepted as edge case. Critic should catch trivial plans as lacking substance. Low-effort gaming isn't the threat model—plugin targets agents/users who want gap discipline.

### GAP-37: Gate.yml parsing relies on fragile string manipulation — RESOLVED (acknowledged)
- **Category**: risk
- **Severity**: medium
- **Resolution**: Acknowledged as MVP limitation. Paths/values unlikely to contain colons or special characters. No external YAML parser dependency. Fix if issues arise in practice.

### GAP-7: No error handling for subagent failure — RESOLVED
- **Category**: missing
- **Severity**: medium
- **Resolution**: Retry once on failure. If subagent times out, crashes, or returns unparseable output, skill retries once. If second attempt fails, fail closed (block exit). User must fix issue or force-exit plan mode via native hotkey.

### GAP-8: Intent section role unclear — RESOLVED
- **Category**: unclear
- **Severity**: medium
- **Resolution**: Renamed to `## Goals`. Defined as success criteria for the plan. Critic uses Goals to evaluate whether plan achieves stated objectives. Matches common planning conventions.

### GAP-10: Gaming prevention threat model unstated — RESOLVED
- **Category**: assumption
- **Severity**: medium
- **Resolution**: Documented as defense-in-depth. Not about conspiracy—prevents accidental priming. Critic shouldn't see agent's gap framing before independent analysis. Independent discovery is more valuable than confirming known gaps. Isolation ensures critic finds gaps the agent missed, not just validates gaps agent already documented.

### GAP-16: Semantic coverage threshold undefined — RESOLVED
- **Category**: unclear
- **Severity**: medium
- **Resolution**: Added coverage rubric to design.md: PASS if all HIGH and MEDIUM severity findings covered, FAIL if any HIGH or MEDIUM uncovered. LOW findings deferred by default. Validator errs on side of coverage (benefit of doubt). Updated spec with coverage criteria.

### GAP-17: External yq dependency unspecified — RESOLVED
- **Category**: assumption
- **Severity**: medium
- **Resolution**: Replaced yq with portable grep-based YAML parsing in design.md hook logic. Uses `grep '^key:' | cut -d' ' -f2` which works on any POSIX system. No external dependencies.

### GAP-20: Opt-in circularity unacknowledged — RESOLVED (acknowledged)
- **Category**: risk
- **Severity**: medium
- **Resolution**: Added explicit acknowledgment in design.md. This is an intentional trade-off: forcing assessment would be intrusive. Plugin targets users/agents who want gap discipline, not those who need to be forced. Future work noted for automated invocation option.

### GAP-34: Critic severity assignment algorithm undefined — RESOLVED
- **Category**: unclear
- **Severity**: low
- **Resolution**: LLM judgment with prompt guidance. Critic prompt instructs: HIGH = blocks implementation, MEDIUM = degrades functionality, LOW = minor issue. Explicit rubrics too rigid for LLM critic.

### GAP-35: Hash algorithm not explicitly documented — RESOLVED
- **Category**: missing
- **Severity**: low
- **Resolution**: Accepted as implementation detail. SHA-256 (`shasum -a 256`) is standard, visible in hook code. No need to over-document.

### GAP-11: Hook error messages unspecified — RESOLVED
- **Category**: missing
- **Severity**: low
- **Resolution**: Standard message format: `[RODIN] <what failed>: <reason>. To fix: <guidance>`. Human-readable with actionable guidance. Examples in design.md hook code.

### GAP-12: Performance/timeout unspecified — RESOLVED
- **Category**: missing
- **Severity**: low
- **Resolution**: Use Task tool's default timeout (2 minutes). Sufficient for critic/validator subagents. No custom timeout or env var needed for MVP.

### GAP-18: No artifact cleanup policy — RESOLVED
- **Category**: missing
- **Severity**: low
- **Resolution**: Manual cleanup for MVP. User runs `rm ~/.claude/plans/rodin-plan-gate/*` when needed. Automated cleanup deferred to future work.

### GAP-22: Leakage detection may false-positive — RESOLVED (acknowledged)
- **Category**: risk
- **Severity**: low
- **Resolution**: Accepted trade-off. 3+ keyword threshold may false-positive on cautious plans. Cheap to implement, easy to remove. Critic catches real gaps regardless.

### GAP-23: session_id stability not guaranteed — RESOLVED (acknowledged)
- **Category**: assumption
- **Severity**: high
- **Resolution**: Accepted as MVP limitation. Platform dependency outside our control. If session_id changes, user re-runs assessment. Error messages guide recovery.

### GAP-24: Skip bypass can be added by agent — RESOLVED
- **Category**: risk
- **Severity**: medium
- **Resolution**: Removed skip bypass mechanism entirely. No `<!-- RODIN:ASSESSMENT_SKIPPED -->` comment support. Users who need to bypass must use native Claude Code hotkey to force-exit plan mode (outside our control).

### GAP-25: No file system error handling in hooks — RESOLVED
- **Category**: missing
- **Severity**: medium
- **Resolution**: Fail closed on FS errors. Hook removes `2>/dev/null` suppressions and adds explicit error checks. If hook can't verify (permissions, disk full, etc.), block exit with clear error message. Strict enforcement prevents silent failures.

### GAP-26: Gaps.md must be created after plan edit — RESOLVED
- **Category**: unclear
- **Severity**: low
- **Resolution**: Documented as workflow requirement. Skill flow enforces order: plan edit first (creates gate.yml), then gaps.md. No code change needed—skill prompts guide correct sequence.

### GAP-27: Skip bypass requires gate.yml to exist — RESOLVED (no longer applicable)
- **Category**: unclear
- **Severity**: low
- **Resolution**: Skip bypass mechanism removed entirely (GAP-24). This gap no longer applies.

### GAP-28: Skill depends on plan file path in system context — RESOLVED (acknowledged)
- **Category**: assumption
- **Severity**: high
- **Resolution**: Accepted as MVP limitation. Platform dependency—skill requires plan mode context. If unavailable, skill fails with clear error "Must be invoked in plan mode". No fallback heuristics.

### GAP-29: Critic isolation is soft constraint — RESOLVED (acknowledged)
- **Category**: assumption
- **Severity**: medium
- **Resolution**: Accepted as defense-in-depth. Critic receives plan content via Task tool input, not file paths. Realistic threat is accidental priming, not adversarial critic subagent. Soft isolation sufficient for MVP.

## RESOLVED (No Longer Applicable)

| Original | Resolution |
|----------|------------|
| GAP-1: Hooks can't spawn subagents | Design pivoted to skill-based approach |
| GAP-2: Coverage algorithm undefined | Validator uses LLM semantic judgment |
| GAP-4: "Lazy init" contradiction | Rewritten - skill prompts, doesn't lazy-init |
| GAP-6: Confidence scoring undefined | Removed from design entirely |
| GAP-9: Subagent A prompt inconsistency | Critic focus now aligned across artifacts |
